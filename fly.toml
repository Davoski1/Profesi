# Fly.io Configuration for PROFESI
app = "profesi-disaster-prediction"
primary_region = "iad"

# Use docker-compose builder
[build]
  builder = "heroku:22"
  
[build.args]
  COMPOSE_FILE = "docker-compose.yml"

# Environment variables
[env]
  FLASK_ENV = "production"
  POSTGRES_USER = "profesi_user"
  POSTGRES_PASSWORD = "profesi123"
  POSTGRES_DB = "profesi_db"
  DATABASE_URL = "postgresql://profesi_user:profesi123@postgres:5432/profesi_db"

# Frontend service
[[services]]
  protocol = "tcp"
  internal_port = 3000
  ports = [{handlers = ["http"], port = 80}, {handlers = ["tls", "http"], port = 443}]
  force_https = true

# Gateway service
[[services]]
  protocol = "tcp"
  internal_port = 8000
  ports = [{handlers = ["http"], port = 8000}]

# PostgreSQL
[[services]]
  protocol = "tcp"
  internal_port = 5432
  ports = [{handlers = [], port = 5432}]

# pgAdmin
[[services]]
  protocol = "tcp"
  internal_port = 5050
  ports = [{handlers = ["http"], port = 5050}]

# VM configuration (1GB RAM, shared CPU)
[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 1024

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = true
  auto_start_machines = true
  min_machines_running = 1